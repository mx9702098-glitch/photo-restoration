# 老照片修复功能 - 产品需求文档

**项目名称**：小耕AI - 老照片修复功能  
**版本号**：V1.0  
**创建日期**：2025-10-24  
**产品经理**：待定  
**开发团队**：待定  

---

# 一、需求背景（需求的价值和目的）

### 需求背景 & 需求来源（要做什么）

在村级服务平台的使用过程中，我们发现村民对于家庭老照片的修复需求非常强烈。许多村民家中保存着珍贵的老照片，记录了家族历史、村庄变迁等重要时刻，但由于年代久远，这些照片普遍存在模糊、褪色、划痕等问题。

**需求来源**：
- 村民在使用村级服务平台时，多次提出希望能够修复老照片的需求
- 传统照片修复服务价格昂贵（单张50-200元），且需要邮寄实体照片，流程繁琐
- 村民普遍不具备使用专业修图软件的能力
- 乡村振兴背景下，保护和传承乡村文化记忆的需求日益增长

**要做什么**：
开发一个基于AI技术的老照片修复功能，让村民通过手机即可一键修复老照片，提升照片清晰度，去除划痕和瑕疵，并支持分享到村友圈。

---

### 需求目标用户，以及用户特点（为谁做）

**目标用户画像**：

1. **主要用户群体**：
   - 年龄：35-65岁
   - 地域：农村地区村民
   - 文化程度：初中及以下学历为主
   - 手机使用能力：基础操作（拍照、发朋友圈）

2. **用户特点**：
   - ✅ 对家族历史和老照片有情感依赖
   - ✅ 希望操作简单，一键完成
   - ✅ 喜欢在村友圈分享生活点滴
   - ✅ 对价格敏感，希望免费或低成本使用
   - ❌ 不熟悉复杂的图片编辑操作
   - ❌ 对技术术语理解有限

3. **典型使用场景**：
   - 家庭聚会时翻出老照片，想修复后分享
   - 整理家族相册，希望保存清晰版本
   - 村史编纂需要清晰的历史照片
   - 在村友圈分享家族故事

---

### 需求出发点，以及能够解决的问题（为什么做）

**需求出发点**：

1. **文化传承价值**：
   - 老照片是乡村文化记忆的重要载体
   - 帮助村民保护和传承家族历史
   - 支持村史、村志的编纂工作

2. **用户痛点**：
   - 传统修复服务价格高昂（50-200元/张）
   - 需要邮寄实体照片，流程繁琐，周期长（1-2周）
   - 专业修图软件操作复杂，学习成本高
   - 村民缺乏技术手段和渠道

3. **平台价值**：
   - 提升村级服务平台的用户粘性
   - 增加村友圈的内容丰富度
   - 体现平台的AI技术能力
   - 促进村民之间的情感连接

**能够解决的问题**：

| 问题 | 传统方式 | 本功能解决方案 |
|------|---------|---------------|
| **成本高** | 50-200元/张 | 免费使用 |
| **流程繁琐** | 邮寄实体照片，1-2周 | 手机拍照，3秒完成 |
| **操作复杂** | 需要学习PS等专业软件 | 一键修复，零学习成本 |
| **效果不稳定** | 依赖人工技术水平 | AI标准化处理，效果稳定 |
| **分享不便** | 需要扫描或翻拍 | 直接分享到村友圈 |

---

# 二、需求描述（详细业务逻辑描述）

## 2.1 功能流程图

```
开始
  ↓
用户点击"老照片变清晰"按钮
  ↓
弹出上传选择框
  ├─ 从手机相册选择
  └─ 对着老照片拍一张
  ↓
用户选择/拍摄照片
  ↓
显示原图（用户消息气泡）
  ↓
显示处理中动画（0-100%进度）
  ├─ 修复老照片
  ├─ 去除划痕
  ├─ 去除瑕疵点
  └─ 提升细节
  ↓
显示提示文案："这是小耕为你修复的老照片，点击查看。"
  ↓
显示修复后照片（带"小耕AI生成"水印）
  ↓
用户点击照片
  ↓
进入对比页面
  ├─ 左右滑动查看修复前后对比
  ├─ 保存到手机相册
  ├─ 发到村友圈
  └─ 再来一张
  ↓
【发到村友圈分支】
  ↓
进入发布页面
  ├─ 预设文案："看看小耕帮我修的这张老照片，是不是真清楚！"
  ├─ 话题标签：#小耕修老照片#
  ├─ 自动添加2张照片（修复后+原图）
  ├─ 可添加更多照片
  └─ 可编辑文案
  ↓
点击"发布"按钮
  ↓
发布成功提示
  ↓
返回聊天页面，显示成功消息
  ↓
结束
```

---

## 2.2 详细操作步骤

### 步骤1：进入功能
- **触发方式**：点击底部固定的"老照片变清晰"按钮
- **按钮样式**：
  - 图标：📸✨
  - 文字：老照片变清晰
  - 颜色：渐变橙红色（#FF6B6B → #FF8E53）
  - 位置：底部固定，毛玻璃效果背景

### 步骤2：选择照片
- **弹出模态框**，包含：
  - 标题："选择照片"
  - 动画演示区：展示修复前后对比动画
  - 两个选项按钮：
    - 📱 从手机相册里选（主按钮，蓝色）
    - 📷 对着老照片拍一张（次按钮，灰色）

### 步骤3：上传照片
- **相册选择**：调用系统相册选择器
- **拍照模式**：调用系统相机，后置摄像头
- **支持格式**：JPG、PNG、HEIC等常见图片格式
- **文件大小限制**：建议10MB以内

### 步骤4：显示原图
- 在聊天区域显示用户消息气泡："老照片变清晰"
- 延迟300ms后显示用户上传的原图
- 图片样式：
  - 宽度：240px
  - 圆角：16px
  - 阴影：0 4px 16px rgba(0,0,0,0.15)

### 步骤5：处理中动画
- **延迟600ms后显示处理卡片**
- 卡片样式：
  - 尺寸：180px × 280px
  - 背景：渐变紫粉色（#B8A4FF → #E8B4FF → #FFB4D4）
  - 圆角：16px
- 动画元素：
  - ✨ 图标（旋转+缩放动画）
  - 进度百分比（0% → 100%）
  - 提示文字："修复老照片，去除划痕，瑕疵点，提升细节"
- **进度更新规则**：
  - 每200ms更新一次
  - 每次增加3-15个百分点（随机）
  - 总时长约3-5秒

### 步骤6：显示修复结果
- **移除处理卡片**
- **先显示提示文案**（AI消息气泡）：
  - "这是小耕为你修复的老照片，点击查看。"
- **延迟300ms后显示修复后照片**：
  - 应用图像增强效果：
    - 对比度：1.2
    - 亮度：1.1
    - 饱和度：1.15
  - 添加水印："小耕AI生成"
    - 位置：右下角
    - 字体：Arial Bold 24px
    - 颜色：白色半透明（opacity: 0.6）
  - 照片可点击，进入对比页面

### 步骤7：对比页面
- **页面结构**：
  - 顶部导航栏：返回按钮 + 标题"修复结果"
  - 中间对比区域：全屏显示
  - 底部操作按钮区域

- **对比功能**：
  - 默认显示修复后照片（全屏）
  - 左侧叠加修复前照片（宽度50%）
  - 中间白色滑块（宽度4px）
  - 滑块手柄：白色圆形，48px，⇄ 图标
  - 支持拖动滑块左右滑动
  - 支持点击任意位置快速定位

- **滑动提示**：
  - 进入页面300ms后显示
  - 内容："👆 左右滑动看看效果"
  - 样式：黑色半透明背景，白色文字
  - 3秒后自动淡出

- **操作按钮**（从上到下）：
  1. **📤 发到村友圈**（主按钮，蓝色）
  2. **💾 保存到手机相册**（次按钮，灰色）
  3. **🔄 再来一张**（边框按钮，蓝色边框）

### 步骤8：发布到村友圈
- **触发方式**：点击"发到村友圈"按钮
- **页面结构**：
  - 顶部导航：返回 + 标题"分享生活" + 更多
  - 内容编辑区域
  - 底部操作按钮

- **预设内容**：
  - 文案：`看看小耕帮我修的这张老照片，是不是真清楚！`
  - 话题标签：`#小耕修老照片#`
  - 照片：自动添加2张
    - 图1：修复后照片（带水印）
    - 图2：原图

- **可编辑内容**：
  - 文案可修改
  - 照片可删除（点击右上角×）
  - 可添加更多照片（最多9张）
  - 可添加更多话题标签

- **辅助功能**：
  - 🎤 语音转文字
  - 😊 添加话题

- **操作按钮**：
  - 保存草稿（绿色边框）
  - 发布（绿色填充）

### 步骤9：发布成功
- 显示Toast："发布成功！"
- 关闭发布页面
- 返回聊天页面
- 显示AI消息：
  - "✅ 已成功发布到村友圈！"
  - "已分享修复前后对比图（2张照片）"

---

## 2.3 业务逻辑

### 图像处理逻辑

1. **图像增强算法**：
   ```javascript
   // 应用CSS滤镜增强
   ctx.filter = 'contrast(1.2) brightness(1.1) saturate(1.15)';
   ctx.drawImage(img, 0, 0);
   ```

2. **水印添加**：
   - 文字："小耕AI生成"
   - 位置：右下角，距离边缘15px
   - 字体：Arial Bold 24px
   - 颜色：rgba(255, 255, 255, 0.6)
   - 对齐：右对齐，底部对齐

3. **图片输出**：
   - 格式：JPEG
   - 质量：95%
   - 保持原始分辨率

### 进度模拟逻辑

```javascript
// 每200ms更新一次进度
progress += Math.random() * 12 + 3; // 每次增加3-15个百分点
if (progress > 100) progress = 100;

// 达到100%后延迟500ms显示结果
```

### 对比滑块逻辑

1. **初始状态**：滑块位于中间（50%）
2. **拖动交互**：
   - 支持鼠标拖动（PC端）
   - 支持触摸拖动（移动端）
   - 拖动范围：0% - 100%
3. **点击交互**：点击任意位置，滑块快速移动到该位置
4. **图片同步**：
   - 修复前照片宽度 = 滑块位置百分比
   - 两张图片尺寸保持一致

### 发布逻辑

1. **照片管理**：
   - 默认添加2张照片（修复后+原图）
   - 支持删除任意照片
   - 支持添加更多照片（最多9张）
   - 照片按3列网格布局

2. **文案管理**：
   - 预设文案可编辑
   - 话题标签自动添加
   - 支持语音转文字（待开发）

3. **发布校验**：
   - 文案不能为空
   - 至少包含1张照片
   - 发布成功后返回聊天页面

---

## 2.4 数据流向

```
用户上传照片
  ↓
[前端] 读取文件 → Base64编码
  ↓
[前端] 存储到变量 originalImage
  ↓
[前端] 显示原图
  ↓
[前端] 模拟处理进度（0-100%）
  ↓
[前端] Canvas图像处理
  ├─ 应用滤镜增强
  └─ 添加水印
  ↓
[前端] 导出为Base64 → 存储到 processedImage
  ↓
[前端] 显示修复后照片
  ↓
[用户操作] 点击"发到村友圈"
  ↓
[前端] 生成发布内容
  ├─ 文案
  ├─ 话题标签
  └─ 照片数组 [processedImage, originalImage]
  ↓
[前端] 用户编辑并确认
  ↓
[前端] 点击"发布"按钮
  ↓
[后端API] POST /api/moments/create
  ├─ content: 文案内容
  ├─ hashtags: ["小耕修老照片"]
  ├─ images: [图片URL数组]
  └─ userId: 当前用户ID
  ↓
[后端] 保存到数据库
  ↓
[后端] 返回发布结果
  ↓
[前端] 显示成功提示
  ↓
[前端] 返回聊天页面
```

**注意**：当前版本为前端Demo，图像处理在客户端完成，未调用后端AI服务。

---

## 2.5 预期表现

### 性能指标

| 指标 | 目标值 | 说明 |
|------|--------|------|
| 照片上传响应时间 | < 500ms | 从选择照片到显示原图 |
| 处理动画时长 | 3-5秒 | 模拟AI处理过程 |
| 图像处理时间 | < 1秒 | Canvas处理+水印添加 |
| 对比页面加载时间 | < 300ms | 图片加载+滑块初始化 |
| 发布页面打开时间 | < 200ms | 页面渲染+内容填充 |

### 用户体验指标

| 指标 | 目标值 | 说明 |
|------|--------|------|
| 操作步骤 | ≤ 3步 | 上传→查看→发布 |
| 学习成本 | 0 | 无需教程，直觉操作 |
| 成功率 | > 95% | 照片修复成功率 |
| 用户满意度 | > 4.5分 | 5分制评分 |

### 视觉效果

1. **修复效果**：
   - 对比度提升20%
   - 亮度提升10%
   - 饱和度提升15%
   - 视觉上更清晰、更鲜艳

2. **动画效果**：
   - 处理中图标旋转+缩放动画（1.5秒循环）
   - 进度百分比平滑增长
   - 页面切换滑动动画（0.3秒）
   - 按钮点击缩放反馈（0.2秒）

3. **交互反馈**：
   - 按钮点击：缩放至98%
   - Toast提示：2秒自动消失
   - 滑动提示：3秒淡出
   - 加载状态：毛玻璃效果

---

## 2.6 原型图 / 交互辅助

### 页面结构

```
┌─────────────────────────────────┐
│  ☰  道义              ⚙️        │ ← 顶部导航栏
├─────────────────────────────────┤
│                                 │
│  [AI消息气泡]                   │
│  👋 你好！我是小耕AI...         │
│                                 │
│              [用户消息气泡]     │
│              老照片变清晰       │
│                                 │
│              [用户上传的照片]   │
│                                 │
│  [处理中卡片]                   │
│  ┌─────────────┐                │
│  │     ✨      │                │
│  │     85%     │                │
│  │  修复中...  │                │
│  └─────────────┘                │
│                                 │
│  [AI消息气泡]                   │
│  这是小耕为你修复的老照片...    │
│                                 │
│  [修复后照片 - 可点击]          │
│                                 │
├─────────────────────────────────┤
│  📸✨ 老照片变清晰              │ ← Action Bar
└─────────────────────────────────┘
```

### 对比页面

```
┌─────────────────────────────────┐
│  ←  修复结果                    │ ← 顶部导航
├─────────────────────────────────┤
│                                 │
│     [修复前]  │  [修复后]       │
│               ⇄                 │ ← 滑块
│                                 │
│  👆 左右滑动看看效果            │ ← 提示（3秒后消失）
│                                 │
├─────────────────────────────────┤
│  📤 发到村友圈                  │
│  💾 保存到手机相册              │
│  🔄 再来一张                    │
└─────────────────────────────────┘
```

### 发布页面

```
┌─────────────────────────────────┐
│  ←  分享生活              ⋯     │ ← 顶部导航
├─────────────────────────────────┤
│  请输入你要分享的内容...        │
│                                 │
│  [文案编辑区]                   │
│  看看小耕帮我修的这张老照片...  │
│                                 │
│  #小耕修老照片#                 │
│                                 │
│  🎤 语音转文字  😊 添加话题     │
│                                 │
│  [照片网格 - 3列]               │
│  ┌───┬───┬───┐                  │
│  │ 1 │ 2 │ + │                  │
│  └───┴───┴───┘                  │
│                                 │
├─────────────────────────────────┤
│  [保存草稿]    [发布]           │
└─────────────────────────────────┘
```

---

## 2.7 字段说明

### 前端数据结构

```javascript
// 照片数据
{
  originalImage: String,      // 原图Base64
  processedImage: String,     // 修复后照片Base64
  uploadTime: Number,         // 上传时间戳
  processTime: Number         // 处理耗时（ms）
}

// 发布内容
{
  content: String,            // 文案内容
  hashtags: Array<String>,    // 话题标签数组
  images: Array<String>,      // 图片URL数组
  userId: String,             // 用户ID
  createTime: Number          // 创建时间戳
}
```

### 后端API字段（待开发）

**POST /api/photo/restore**
```json
{
  "image": "base64编码的图片",
  "userId": "用户ID",
  "options": {
    "enhance": true,          // 是否增强
    "removeScratches": true,  // 是否去除划痕
    "colorize": false         // 是否上色（未来功能）
  }
}
```

**Response**
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "restoredImage": "base64编码的修复后图片",
    "processTime": 3200,      // 处理耗时（ms）
    "quality": 0.95           // 输出质量
  }
}
```

---

## 2.8 涉及的相关系统模块

### 当前版本（V1.0 - 前端Demo）

| 模块 | 功能 | 优先级 | 状态 |
|------|------|--------|------|
| 聊天界面 | 对话流交互 | P0 | ✅ 已完成 |
| 照片上传 | 相册选择/拍照 | P0 | ✅ 已完成 |
| 图像处理 | Canvas滤镜增强 | P0 | ✅ 已完成 |
| 水印添加 | "小耕AI生成"水印 | P0 | ✅ 已完成 |
| 对比功能 | 滑动对比查看 | P0 | ✅ 已完成 |
| 发布功能 | 分享到村友圈 | P0 | ✅ 已完成 |
| 保存功能 | 下载到本地 | P0 | ✅ 已完成 |

### 未来版本（V2.0 - 后端集成）

| 模块 | 功能 | 优先级 | 状态 |
|------|------|--------|------|
| AI修复服务 | 真实AI图像修复 | P0 | ⏳ 待开发 |
| 用户系统 | 登录/鉴权 | P0 | ⏳ 待开发 |
| 村友圈系统 | 动态发布/展示 | P0 | ⏳ 待开发 |
| 存储服务 | 图片上传/存储 | P0 | ⏳ 待开发 |
| 数据统计 | 使用数据上报 | P1 | ⏳ 待开发 |
| 历史记录 | 修复历史查看 | P1 | ⏳ 待开发 |
| 批量处理 | 多张照片批量修复 | P2 | ⏳ 待开发 |
| 高级功能 | 上色/去噪/超分辨率 | P2 | ⏳ 待开发 |

---

## 2.9 对其他业务模块可能带来的影响

### 正面影响

1. **村友圈模块**：
   - ✅ 增加内容丰富度（老照片+故事）
   - ✅ 提升用户活跃度和互动率
   - ✅ 增加情感化内容，促进村民连接
   - ✅ 预计村友圈发布量提升20-30%

2. **用户增长**：
   - ✅ 提供差异化功能，吸引新用户
   - ✅ 提升用户留存率（工具型功能）
   - ✅ 口碑传播（"帮我修老照片"）

3. **平台价值**：
   - ✅ 体现AI技术能力
   - ✅ 提升平台科技感和现代化形象
   - ✅ 增强用户对平台的信任度

### 潜在风险

1. **存储压力**：
   - ⚠️ 图片存储量增加（每次修复产生2张图片）
   - **解决方案**：
     - 压缩图片质量（JPEG 85%）
     - 设置存储时限（30天后自动清理）
     - 使用CDN加速访问

2. **性能压力**：
   - ⚠️ AI修复服务可能产生计算压力
   - **解决方案**：
     - 限制单用户每日修复次数（10次）
     - 使用队列异步处理
     - 高峰期降级为简单增强

3. **内容审核**：
   - ⚠️ 用户可能上传不当内容
   - **解决方案**：
     - 接入图片内容审核API
     - 敏感内容自动拦截
     - 人工复审机制

4. **版权问题**：
   - ⚠️ 用户可能上传他人照片
   - **解决方案**：
     - 用户协议明确版权责任
     - 添加水印保护
     - 举报机制

---

# 三、数据上报需求

## 3.1 核心数据指标

### 功能使用数据

| 事件名称 | 触发时机 | 上报字段 | 说明 |
|---------|---------|---------|------|
| `photo_restore_start` | 点击"老照片变清晰"按钮 | userId, timestamp | 功能入口点击 |
| `photo_upload_success` | 照片上传成功 | userId, uploadMethod, fileSize, timestamp | 上传方式：album/camera |
| `photo_restore_complete` | 修复完成 | userId, processTime, imageSize, timestamp | 处理耗时 |
| `photo_comparison_view` | 进入对比页面 | userId, timestamp | 查看对比 |
| `photo_save` | 保存到相册 | userId, timestamp | 保存行为 |
| `photo_share_to_circle` | 点击"发到村友圈" | userId, timestamp | 分享意图 |
| `photo_publish_success` | 发布成功 | userId, photoCount, hasOriginal, timestamp | 发布成功 |
| `photo_retry` | 点击"再来一张" | userId, timestamp | 重新修复 |

### 用户行为数据

| 指标 | 说明 | 计算方式 |
|------|------|---------|
| 日活跃用户（DAU） | 每日使用功能的用户数 | 去重userId统计 |
| 修复成功率 | 修复成功次数/上传次数 | success_count / upload_count |
| 分享率 | 发布到村友圈次数/修复次数 | publish_count / restore_count |
| 保存率 | 保存到相册次数/修复次数 | save_count / restore_count |
| 平均处理时长 | 从上传到完成的平均时间 | avg(processTime) |
| 重试率 | 点击"再来一张"次数/修复次数 | retry_count / restore_count |

### 业务价值数据

| 指标 | 说明 | 目标值 |
|------|------|--------|
| 功能渗透率 | 使用过功能的用户/总用户 | > 30% |
| 村友圈内容增长 | 带#小耕修老照片#的动态数 | +20% |
| 用户留存提升 | 使用功能后的7日留存率 | +15% |
| 用户满意度 | 功能评分（5分制） | > 4.5 |

---

## 3.2 数据上报示例

```javascript
// 功能入口点击
trackEvent('photo_restore_start', {
  userId: '123456',
  timestamp: 1729756800000,
  source: 'action_bar'  // 来源：action_bar/chat/menu
});

// 照片上传成功
trackEvent('photo_upload_success', {
  userId: '123456',
  uploadMethod: 'album',  // album/camera
  fileSize: 2048576,      // 字节
  imageWidth: 1920,
  imageHeight: 1080,
  timestamp: 1729756801000
});

// 修复完成
trackEvent('photo_restore_complete', {
  userId: '123456',
  processTime: 3200,      // 毫秒
  imageSize: 2048576,
  enhanceLevel: 'standard',  // standard/high
  timestamp: 1729756804200
});

// 发布成功
trackEvent('photo_publish_success', {
  userId: '123456',
  photoCount: 2,          // 发布的照片数量
  hasOriginal: true,      // 是否包含原图
  contentLength: 45,      // 文案字数
  hashtags: ['小耕修老照片'],
  timestamp: 1729756810000
});
```

---

## 3.3 数据分析维度

### 用户维度
- 年龄分布
- 地域分布
- 使用频次分布
- 活跃时段分布

### 功能维度
- 上传方式偏好（相册 vs 拍照）
- 对比页面停留时长
- 分享率 vs 保存率
- 重试原因分析

### 内容维度
- 照片类型分布（人物/风景/建筑）
- 照片年代分布
- 修复效果满意度
- 村友圈互动数据

---

# 四、AI 服务开发需求

## 4.1 AI能力需求

### 当前版本（V1.0）
- **实现方式**：前端Canvas滤镜增强
- **效果**：基础的对比度、亮度、饱和度调整
- **优点**：响应快速，无需后端支持
- **缺点**：效果有限，无法处理复杂问题

### 未来版本（V2.0）
需要接入真实的AI图像修复服务，实现以下能力：

---

## 4.2 AI修复能力清单

### P0 核心能力（必须）

1. **图像增强**
   - 自动调整对比度、亮度、饱和度
   - 锐化处理，提升清晰度
   - 去噪处理，减少颗粒感
   - **输出效果**：照片整体更清晰、更鲜艳

2. **划痕修复**
   - 自动检测并修复照片划痕
   - 修复折痕、裂纹
   - 修复水渍、污渍
   - **输出效果**：照片表面干净，无明显瑕疵

3. **细节恢复**
   - 恢复模糊的人脸细节
   - 恢复文字清晰度
   - 恢复建筑物细节
   - **输出效果**：关键内容清晰可辨

---

### P1 进阶能力（重要）

4. **超分辨率**
   - 将低分辨率照片放大2-4倍
   - 保持放大后的清晰度
   - **输出效果**：小照片变大照片，不失真

5. **去雾/去黄**
   - 去除老照片的泛黄效果
   - 去除雾化、模糊效果
   - **输出效果**：照片色彩还原，通透明亮

6. **人脸修复**
   - 针对人脸区域的专项修复
   - 恢复五官细节
   - 修复模糊的表情
   - **输出效果**：人脸清晰，表情自然

---

### P2 高级能力（可选）

7. **黑白照片上色**
   - 自动为黑白照片添加颜色
   - 智能识别场景（人物/风景/建筑）
   - 颜色自然真实
   - **输出效果**：黑白照片变彩色照片

8. **破损修复**
   - 修复严重破损的照片
   - 智能补全缺失部分
   - **输出效果**：破损照片恢复完整

9. **批量处理**
   - 一次上传多张照片
   - 批量修复
   - **输出效果**：提升效率，节省时间

---

## 4.3 AI服务输出效果预期

### 示例1：人物老照片修复

**输入**：
- 照片类型：黑白人物照
- 问题：模糊、划痕、泛黄
- 分辨率：800×600

**输出**：
- 清晰度提升：✅ 人脸五官清晰可辨
- 划痕修复：✅ 表面划痕完全消除
- 色彩还原：✅ 去除泛黄，黑白对比度提升
- 分辨率：保持800×600或放大至1600×1200
- 水印：右下角"小耕AI生成"

**效果对比**：
```
修复前：模糊、有划痕、泛黄
修复后：清晰、干净、黑白分明
```

---

### 示例2：风景老照片修复

**输入**：
- 照片类型：彩色风景照
- 问题：褪色、模糊、噪点
- 分辨率：1024×768

**输出**：
- 色彩还原：✅ 饱和度提升，颜色鲜艳
- 清晰度提升：✅ 建筑物、树木细节清晰
- 去噪处理：✅ 颗粒感消除
- 分辨率：保持1024×768
- 水印：右下角"小耕AI生成"

**效果对比**：
```
修复前：褪色、模糊、有噪点
修复后：色彩鲜艳、清晰、干净
```

---

## 4.4 AI服务技术要求

### 性能要求

| 指标 | 要求 | 说明 |
|------|------|------|
| 处理时长 | < 5秒 | 单张照片修复时间 |
| 并发能力 | > 100 QPS | 支持同时处理请求数 |
| 成功率 | > 95% | 修复成功率 |
| 可用性 | > 99.9% | 服务可用性 |

### 质量要求

| 指标 | 要求 | 说明 |
|------|------|------|
| 清晰度提升 | > 30% | 主观评分提升 |
| 色彩还原度 | > 80% | 与原始色彩的相似度 |
| 划痕修复率 | > 90% | 可见划痕的修复比例 |
| 用户满意度 | > 4.5分 | 5分制评分 |

### 接口要求

**请求格式**：
```json
POST /api/ai/photo/restore
Content-Type: application/json

{
  "image": "base64编码的图片",
  "userId": "用户ID",
  "options": {
    "enhance": true,          // 图像增强
    "removeScratches": true,  // 去除划痕
    "superResolution": false, // 超分辨率
    "colorize": false,        // 上色
    "faceRestore": true       // 人脸修复
  }
}
```

**响应格式**：
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "restoredImage": "base64编码的修复后图片",
    "processTime": 3200,      // 处理耗时（ms）
    "quality": 0.95,          // 输出质量
    "improvements": {         // 改进详情
      "clarity": 0.35,        // 清晰度提升35%
      "colorRestoration": 0.82, // 色彩还原度82%
      "scratchesRemoved": 12  // 修复了12处划痕
    }
  }
}
```

---

## 4.5 AI模型选型建议

### 推荐方案1：腾讯云AI图像修复
- **优点**：
  - 成熟稳定，效果好
  - 接入简单，文档完善
  - 按量计费，成本可控
- **缺点**：
  - 需要付费
  - 依赖外部服务

### 推荐方案2：开源模型（Real-ESRGAN）
- **优点**：
  - 免费开源
  - 效果优秀
  - 可自主部署
- **缺点**：
  - 需要GPU服务器
  - 运维成本高

### 推荐方案3：混合方案
- **P0功能**：使用前端Canvas增强（当前方案）
- **P1功能**：接入腾讯云AI服务
- **P2功能**：自研模型部署

---

# 五、周边接口影响说明

## 5.1 依赖的外部接口

### 当前版本（V1.0）
- **无外部接口依赖**
- 所有功能在前端完成

### 未来版本（V2.0）

#### 1. AI图像修复服务
- **接口地址**：`POST /api/ai/photo/restore`
- **调用频率**：每次修复调用1次
- **限频策略**：
  - 单用户：10次/天
  - 全局：1000次/小时
- **超限处理**：
  - 提示用户"今日修复次数已用完"
  - 降级为前端简单增强

#### 2. 图片存储服务（OSS）
- **接口地址**：`POST /api/storage/upload`
- **调用频率**：每次发布调用2次（原图+修复后）
- **限频策略**：
  - 单用户：50次/天
  - 单文件：< 10MB
- **超限处理**：
  - 压缩图片质量
  - 提示用户"文件过大"

#### 3. 村友圈发布接口
- **接口地址**：`POST /api/moments/create`
- **调用频率**：每次发布调用1次
- **限频策略**：
  - 单用户：20次/天
  - 防刷：同一内容5分钟内不可重复发布
- **超限处理**：
  - 提示用户"发布过于频繁"
  - 保存为草稿

#### 4. 内容审核接口
- **接口地址**：`POST /api/audit/image`
- **调用频率**：每次上传调用1次
- **限频策略**：
  - 全局：5000次/小时
- **超限处理**：
  - 排队等待
  - 异步审核

---

## 5.2 对现有接口的影响

### 村友圈接口
- **影响**：发布量预计增加20-30%
- **应对措施**：
  - 优化数据库查询性能
  - 增加缓存层
  - 考虑分库分表

### 用户系统接口
- **影响**：用户活跃度提升，登录请求增加
- **应对措施**：
  - 优化登录流程
  - 增加Token有效期

### 存储服务
- **影响**：图片存储量大幅增加
- **应对措施**：
  - 启用CDN加速
  - 定期清理过期图片
  - 压缩图片质量

---

## 5.3 接口限频策略

| 接口 | 限频规则 | 超限处理 |
|------|---------|---------|
| AI修复服务 | 10次/天/用户 | 降级为前端增强 |
| 图片上传 | 50次/天/用户 | 提示"上传次数已用完" |
| 村友圈发布 | 20次/天/用户 | 保存为草稿 |
| 内容审核 | 5000次/小时/全局 | 排队等待 |

---

# 六、其他需关注的信息

## 6.1 技术栈

### 前端
- **框架**：原生HTML + CSS + JavaScript
- **图像处理**：Canvas API
- **动画**：CSS Animation + Transition
- **兼容性**：iOS 12+, Android 8+

### 后端（未来）
- **语言**：Node.js / Python
- **框架**：Express / FastAPI
- **数据库**：MySQL / MongoDB
- **存储**：腾讯云COS / 阿里云OSS
- **AI服务**：腾讯云AI / 自研模型

---

## 6.2 兼容性要求

### 浏览器兼容性
- ✅ iOS Safari 12+
- ✅ Android Chrome 80+
- ✅ 微信内置浏览器
- ✅ 支付宝内置浏览器

### 设备兼容性
- ✅ iPhone 6s及以上
- ✅ Android 8.0及以上
- ✅ 屏幕尺寸：320px - 428px宽度

### 功能兼容性
- ✅ 相册选择：所有设备
- ✅ 相机拍照：需要相机权限
- ✅ 文件下载：所有设备
- ⚠️ Canvas处理：低端设备可能较慢

---

## 6.3 安全性考虑

### 数据安全
1. **图片隐私**：
   - 用户上传的照片仅用于修复
   - 不保存到服务器（当前版本）
   - 未来版本需加密存储

2. **内容审核**：
   - 接入图片内容审核API
   - 拦截违规内容
   - 人工复审机制

3. **防刷机制**：
   - 限制单用户修复次数
   - 防止恶意上传
   - IP黑名单

### 权限管理
- 相册访问权限
- 相机访问权限
- 存储访问权限

---

## 6.4 成本估算

### 当前版本（V1.0）
- **开发成本**：已完成，0元
- **运营成本**：0元（纯前端）
- **服务器成本**：0元

### 未来版本（V2.0）

#### AI服务成本
- **腾讯云AI图像修复**：0.1元/次
- **预计调用量**：1000次/天
- **月成本**：3000元

#### 存储成本
- **图片存储**：0.1元/GB/月
- **预计存储量**：100GB/月
- **月成本**：10元

#### 带宽成本
- **CDN流量**：0.2元/GB
- **预计流量**：500GB/月
- **月成本**：100元

**总计月成本**：约3110元

---

## 6.5 上线计划

### 阶段1：内测（1周）
- 时间：2025-10-24 - 2025-10-31
- 范围：10个试点村庄，约500用户
- 目标：
  - 收集用户反馈
  - 发现并修复Bug
  - 优化交互体验

### 阶段2：灰度发布（2周）
- 时间：2025-11-01 - 2025-11-15
- 范围：50个村庄，约5000用户
- 目标：
  - 验证功能稳定性
  - 监控性能指标
  - 优化AI效果

### 阶段3：全量上线（持续）
- 时间：2025-11-16起
- 范围：所有村庄
- 目标：
  - 全面推广功能
  - 持续优化体验
  - 迭代新功能

---

## 6.6 成功指标

### 短期目标（1个月）
- [ ] 功能渗透率 > 30%
- [ ] 日活跃用户 > 1000
- [ ] 修复成功率 > 95%
- [ ] 用户满意度 > 4.5分

### 中期目标（3个月）
- [ ] 功能渗透率 > 50%
- [ ] 日活跃用户 > 5000
- [ ] 村友圈内容增长 > 20%
- [ ] 用户留存提升 > 15%

### 长期目标（6个月）
- [ ] 功能渗透率 > 70%
- [ ] 累计修复照片 > 100万张
- [ ] 成为平台核心功能之一
- [ ] 形成口碑传播效应

---

## 6.7 风险与应对

### 风险1：AI效果不达预期
- **概率**：中
- **影响**：用户满意度下降
- **应对**：
  - 持续优化AI模型
  - 提供多种修复模式供选择
  - 收集用户反馈，针对性改进

### 风险2：成本超支
- **概率**：中
- **影响**：运营成本过高
- **应对**：
  - 限制单用户修复次数
  - 引入会员付费模式
  - 优化算法，降低计算成本

### 风险3：用户隐私问题
- **概率**：低
- **影响**：用户信任度下降
- **应对**：
  - 明确隐私政策
  - 加密存储用户照片
  - 定期清理过期数据

### 风险4：竞品模仿
- **概率**：高
- **影响**：竞争加剧
- **应对**：
  - 持续迭代新功能
  - 深度集成村级服务平台
  - 打造差异化体验

---

## 6.8 后续迭代计划

### V1.1（1个月后）
- [ ] 接入真实AI修复服务
- [ ] 优化修复效果
- [ ] 增加历史记录功能

### V1.2（2个月后）
- [ ] 支持批量修复
- [ ] 增加黑白照片上色功能
- [ ] 优化对比页面交互

### V2.0（3个月后）
- [ ] 支持视频修复
- [ ] 增加AI智能裁剪
- [ ] 支持照片故事生成

---

## 6.9 相关文档

- [技术设计文档](./技术设计文档.md)（待编写）
- [测试用例文档](./测试用例文档.md)（待编写）
- [用户使用手册](./用户使用手册.md)（待编写）
- [运营推广方案](./运营推广方案.md)（待编写）

---

## 6.10 联系方式

- **产品经理**：待定
- **技术负责人**：待定
- **设计负责人**：待定
- **测试负责人**：待定

---

**文档版本**：V1.0  
**最后更新**：2025-10-24  
**审核状态**：待审核  

---

## 附录：参考资料

1. [村级服务平台产品规划](链接)
2. [村友圈功能需求文档](链接)
3. [AI图像修复技术调研报告](链接)
4. [用户调研报告](链接)
5. [竞品分析报告](链接)
